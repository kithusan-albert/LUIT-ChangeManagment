{"name":"7fbf057f-22aa-4c56-a3de-51d70dffc992","id":"/providers/Microsoft.Flow/flows/7fbf057f-22aa-4c56-a3de-51d70dffc992","type":"Microsoft.Flow/flows","properties":{"apiId":"/providers/Microsoft.PowerApps/apis/shared_logicflows","displayName":"ChangeMgmtApplication - Standard and DEV Requests Workflow","definition":{"metadata":{"workflowEntityId":null,"processAdvisorMetadata":null,"flowChargedByPaygo":null,"flowclientsuspensionreason":"None","flowclientsuspensiontime":null,"flowclientsuspensionreasondetails":null,"creator":{"id":"4bbc306b-1a07-4b4e-a1a1-ac54bdac6ae5","type":"User","tenantId":"2ed27e58-4516-4f9c-a797-94374d2e74c7"},"provisioningMethod":"FromDefinition","failureAlertSubscription":true,"clientLastModifiedTime":"2024-10-08T03:01:52.1533631Z","connectionKeySavedTimeKey":"2024-10-08T03:01:52.1533631Z"},"$schema":"https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#","contentVersion":"1.0.0.0","parameters":{"$authentication":{"defaultValue":{},"type":"SecureObject"},"$connections":{"defaultValue":{},"type":"Object"}},"triggers":{"When_request_is_\"Scheduled\"_and_DEV_or_Standard":{"recurrence":{"frequency":"Minute","interval":1},"splitOn":"@triggerOutputs()?['body/value']","type":"OpenApiConnection","inputs":{"parameters":{"dataset":"https://lincolnuniac.sharepoint.com/sites/ChangeMgmtApplication","table":"6378f81e-565b-4717-88f6-3a4eb406d2c2"},"host":{"apiId":"/providers/Microsoft.PowerApps/apis/shared_sharepointonline","connectionName":"shared_sharepointonline","operationId":"GetOnUpdatedItems"},"authentication":"@parameters('$authentication')"}}},"actions":{"Request_-_is_Scheduled":{"actions":{"Get_all_users_details":{"type":"OpenApiConnection","inputs":{"parameters":{"dataset":"https://lincolnuniac.sharepoint.com/sites/ChangeMgmtApplication","table":"bb8483b8-f4d9-4f44-8709-7ef9a2582450","$filter":"Role eq 'Approver' or Role eq 'Admin' or Role eq 'User'\n"},"host":{"apiId":"/providers/Microsoft.PowerApps/apis/shared_sharepointonline","connectionName":"shared_sharepointonline","operationId":"GetItems"},"authentication":"@parameters('$authentication')"}},"For_each_-_users":{"foreach":"@outputs('Get_all_users_details')?['body/value']","actions":{"Send_an_email_notification":{"type":"OpenApiConnection","inputs":{"parameters":{"emailMessage/To":"@item()?['Email']","emailMessage/Subject":"Notification: @{triggerBody()?['Change_Classification']?['Value']} Request - Auto-Approval Confirmation","emailMessage/Body":"\n    <title> @{triggerBody()?['Change_Classification']?['Value']}Auto-Approved</title>\n    <style>\n        body {\n            font-family: Lato, sans-serif;\n            margin: 0;\n            padding: 10px;\n            background-color: #f5f5f5;\n            color: #333;\n        }\n        .container {\n            max-width: 600px;\n            margin: auto;\n            background-color: #fff;\n            border-radius: 5px;\n            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n            padding: 20px;\n        }\n        h1, h2 {\n            color: rgba(11, 9, 55, 1);\n            margin: 0 0 15px;\n            font-size: 18px;\n            border-bottom: 2px solid rgba(11, 9, 55, 0.1);\n            padding-bottom: 10px;\n        }\n        h2 {\n            font-size: 16px;\n            margin-top: 20px;\n        }\n        table {\n            width: 100%;\n            border-collapse: collapse;\n            margin: 15px 0;\n        }\n        th, td {\n            border: 1px solid #e0e0e0;\n            padding: 8px;\n            font-size: 14px;\n        }\n        th {\n            background-color: #fcfcfc;\n            font-weight: bold;\n        }\n        .summary {\n            background-color: #fcfcfc;\n            border: 1px solid #e0e0e0;\n            padding: 10px;\n            margin: 15px 0;\n            font-size: 14px;\n        }\n        .links {\n            margin-top: 15px;\n            font-size: 14px;\n        }\n        .links a {\n            color: rgba(11, 9, 55, 1);\n            text-decoration: none;\n        }\n        .links a:hover {\n            text-decoration: underline;\n        }\n    </style>\n\n\n    <div class=\"container\">\n        <h1> @{triggerBody()?['Change_Classification']?['Value']} Request: @{triggerBody()?['Request_Title']} </h1>\n        <table>\n    <tbody>\n        <tr>\n            <td>Requestor</td>\n            <td>@{triggerBody()?['Requestor_ID_x003a__x0020_FullNa']?['Value']}</td>\n        </tr>\n       <tr>\n            <td>Sponsor</td>\n            <td>@{triggerBody()?['Sponsor_ID_x003a__x0020_FullName']?['Value']}</td>\n        </tr>\n        <tr>\n            <td>Change Classification</td>\n            <td>@{triggerBody()?['Change_Classification']?['Value']}</td>\n        </tr>\n        <tr>\n            <td>Impact</td>\n            <td>@{triggerBody()?['Impact_Level']?['Value']}</td>\n        </tr>\n        <tr>\n            <td>Affected Services</td>\n            <td>@{triggerBody()?['Affected_Services']?['Value']}</td>\n        </tr>\n        <tr>\n            <td>Attachment URL:</td>\n            <td><a href=\"@{triggerBody()?['Attachment_URL']}\" class=\"editor-link\">View Attachment URL</a></td>\n        </tr>\n        <tr>\n            <td>Further Details:</td>\n            <td><a href=\"https://apps.powerapps.com/play/e/5277150f-b052-e9a1-adaf-bf0689cdd0c0/a/706e248f-a5a4-4310-bad8-5ba90d99f4dc?requestId=@{triggerBody()?['Request_ID']}\" class=\"editor-link\">View full request</a></td>\n        </tr>\n    </tbody>\n</table>\n\n        <h2>Implementation</h2>\n\n        <div class=\"summary\">\n            <strong>Justification:</strong> <br>\n@{triggerBody()?['Request_Justification']}\n        </div>\n        <div class=\"summary\">\n            <strong>Implementation Summary:</strong> <br>\n@{triggerBody()?['Implementation_Summary']}\n        </div>\n        <div class=\"summary\">\n            <strong>Test Plan:</strong> <br>\n@{triggerBody()?['Test_Plan']}\n        </div>\n        \n        <div class=\"summary\">\n            <strong>Rollback Plan:</strong> <br>\n @{triggerBody()?['Rollback_Plan']}\n        </div>\n        </div>\n    ","emailMessage/Importance":"Normal"},"host":{"apiId":"/providers/Microsoft.PowerApps/apis/shared_office365","connectionName":"shared_office365","operationId":"SendEmailV2"},"authentication":"@parameters('$authentication')"}}},"runAfter":{"Get_all_users_details":["Succeeded"]},"type":"Foreach"}},"runAfter":{},"else":{"actions":{}},"expression":{"or":[{"equals":["@and(\r\n    equals(triggerBody()?['Request_Status']?['Value'], 'Scheduled'),\r\n    equals(triggerBody()?['Change_Classification']?['Value'], 'Standard')\r\n)\r\n",true]},{"equals":["@and(\r\n    equals(triggerBody()?['Request_Status']?['Value'], 'Scheduled'),\r\n    equals(triggerBody()?['Change_Classification']?['Value'], 'Scheduled')\r\n)\r\n",true]}]},"type":"If"}},"outputs":{}},"connectionReferences":{"shared_sharepointonline":{"connectionName":"shared-sharepointonl-544e8b9c-bfeb-4b28-9012-7a03427aa2e8","source":"Embedded","id":"/providers/Microsoft.PowerApps/apis/shared_sharepointonline","tier":"NotSpecified"},"shared_office365":{"connectionName":"shared-office365-13dad515-91ce-4b7f-a7f1-4f6d51b69402","source":"Embedded","id":"/providers/Microsoft.PowerApps/apis/shared_office365","tier":"NotSpecified"}},"flowFailureAlertSubscribed":false,"isManaged":false}}